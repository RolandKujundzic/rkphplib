{html:meta:keywords}multiple, file, upload{:html}
{html:meta:description}Upload based on Dropzone.js{:html}
{html:inner:title}thumbnail, previews, retina enabled, multiple files, synchronous uploads, browser image resizing,
  progress update, support for large files, complete theming{:html}

{html:append:head}
<script src="../../js/dropzone.js"></script>
<link rel="stylesheet" href="../../css/dropzone.css" />
{:html}

{tpl_set:ajax_output_upload}
{get:*}
{:tpl_set}

{upload:init:file}
save_in= data/upload|#|
thumbnail= 120x120^|#|
ajax_output= ajax_output_upload|#|
{:upload}


<form action="index.php" method="post" class="dropzone" id="dropzone_image" enctype="multipart/form-data">
	<input type="hidden" name="method" value="dropzone">
	<div class="fallback">
		<input type="file" name="image" multiple />
	</div>

<!--
	<div class="dz-message">
		<h3>Olo</h3>
		<i class="fa fa-picture-o fa-5x" aria-hidden="true"></i>
	</div>
-->
</form>

<br><br>

<style>
#myDropzone {
  width:660px;
  height:200px;
  padding:15px;
  border-style:dashed;
  border-color:#2c003a;
  border-width:2px;
  background-color:#fdfbfb;
  color:#462a51;
	overflow: auto;
}
</style>

<form action="index.php" method="post" enctype="multipart/form-data">
	<input type="hidden" id="method" name="method" value="dropzone">
	<input type="hidden" id="remove_image" name="remove_image" value="">

	<div class="dropzone" id="myDropzone"></div>
	<br><br>
	<button type="submit" id="submit-all"> upload </button>
</form>

<script>
Dropzone.options.myDropzone = {
	url: 'index.php',
	autoProcessQueue: false,
	uploadMultiple: true,
	parallelUploads: 5,
	maxFiles: 7,
	maxFilesize: 20, // mb
	acceptedFiles: 'image/*',
	addRemoveLinks: true,
	dictMaxFilesExceeded: "You can not upload more than {{maxFiles}} files.",
	dictRemoveFileConfirmation: "Do you want to remove this file?",
	rk: { currFiles: 0, newFiles: 0 },

	init: function() {
		dzClosure = this; // Makes sure that 'this' is understood inside the functions below.

		// for Dropzone to process the queue (instead of default form behavior):
		document.getElementById("submit-all").addEventListener("click", function(e) {
			// Make sure that the form isn't actually being sent.
			e.preventDefault();
			e.stopPropagation();
			dzClosure.processQueue();
		});

		// send all the form data along with the files:
		this.on("sendingmultiple", function(data, xhr, formData) {
			formData.append("method", document.getElementById('method').value);
			formData.append("remove_image", document.getElementById('remove_image').value);
		});

		this.on("removedfile", function(file) {
			if (file.path) {
				if (document.getElementById('remove_image').value) {
					document.getElementById('remove_image').value += '|#|' + file.name;
				}
				else {
					document.getElementById('remove_image').value = file.name;
				}
			}
		});

		this.on("addedfile", function(file) {
			if (file.url) {
				this.options.rk.currFiles++;
			}
			else {
				this.options.rk.newFiles++;
			}

			if (this.options.maxFiles < this.options.rk.currFiles + this.options.rk.newFiles) {
				this.removeFile(file);
			}
		});

		// add existing files
		var existingFiles = {upload:exists}mode=dropzone{:upload};

		for (var i = 0; i < existingFiles.length; i++) {
			this.emit("addedfile", existingFiles[i]);
			this.emit("thumbnail", existingFiles[i], existingFiles[i].tbnUrl);
			this.emit("complete", existingFiles[i]);
		}
	}
}
</script>
